<?php

namespace Database\Seeders;

use App\Models\Post;
use Illuminate\Support\Str;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\File;
use Illuminate\Support\Facades\Storage;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;

class PostSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $posts = [
            [
                'title' => 'قبة الصخرة',
                'description' => 'قبة الصخرة هي أحد أقدم المعالم الإسلامية البارزة. بُنيت في عهد الخليفة الأموي عبد الملك بن مروان، وهي جزء من المسجد الأقصى المبارك. تتميز القبة بطلائها الذهبي الرائع الذي يضيء سماء القدس، وزخارفها الدقيقة التي تجمع بين فنون العمارة الإسلامية المبكرة وأجمل النقوش الهندسية والخط العربي.',
                'date' => '72 هـ',
                'address' => 'القدس الشريف – فلسطين',
                'author' => 'عبد الملك بن مروان'
            ],
            [
                'title' => 'المسجد النبوي',
                'description' => 'المسجد النبوي هو ثاني أقدس مسجد في الإسلام بعد المسجد الحرام. تأسس على يد النبي محمد صلى الله عليه وسلم في المدينة المنورة، ويضم الروضة الشريفة التي قال عنها النبي إنها "روضة من رياض الجنة". يعتبر المسجد مركزًا دينيًا وتاريخيًا هامًا، وهو يضم أيضًا قبر النبي محمد صلى الله عليه وسلم وصاحبيه أبي بكر وعمر.',
                'date' => '1 هـ',
                'address' => 'المدينة المنورة – السعودية',
                'author' => 'النبي محمد صلى الله عليه وسلم'
            ],
            [
                'title' => 'مصحف عثمان بن عفان',
                'description' => 'مصحف عثمان بن عفان هو أحد أقدم نسخ القرآن الكريم التي تم جمعها وكتابتها في عهد الخليفة الراشد عثمان بن عفان رضي الله عنه. تميزت هذه النسخة بالدقة الكبيرة، وقد أُرسلت نسخ منها إلى أمصار المسلمين لحفظ كتاب الله من التحريف. تحمل بعض النسخ آثار دماء عثمان الذي قُتل وهو يتلو القرآن.',
                'date' => '25 هـ',
                'address' => 'متاحف مختلفة – العالم الإسلامي',
                'author' => 'كتّاب الصحابة'
            ],
            [
                'title' => 'جامع قرطبة',
                'description' => 'جامع قرطبة هو واحد من أعظم معالم الأندلس الإسلامية. بُني في عهد عبد الرحمن الداخل ليكون رمزًا للقوة والازدهار الإسلامي. يتميز بتصميم معماري فريد يجمع بين الأقواس الحمراء والبيضاء، والمحراب المزخرف بدقة فائقة، مما يعكس تفوق الحضارة الإسلامية في فن العمارة.',
                'date' => '170 هـ',
                'address' => 'قرطبة – إسبانيا (الأندلس)',
                'author' => 'عبد الرحمن الداخل'
            ],
            [
                'title' => 'مئذنة جامع القيروان',
                'description' => 'تُعد مئذنة جامع القيروان في تونس من أقدم المآذن في العالم الإسلامي. بُنيت على يد القائد عقبة بن نافع خلال الفتوحات الإسلامية، وتتميز ببساطتها المعمارية التي تجمع بين القوة والجمال. المئذنة شاهدة على تطور فن العمارة الإسلامية منذ القرن الأول الهجري.',
                'date' => '50 هـ',
                'address' => 'القيروان – تونس',
                'author' => 'عقبة بن نافع'
            ],
            [
                'title' => 'قصر الحمراء',
                'description' => 'قصر الحمراء هو درة العمارة الأندلسية، بُني في عهد ملوك بني نصر في غرناطة. يتميز القصر بزخارفه الهندسية الرائعة والخطوط العربية التي تزين جدرانه، بالإضافة إلى تصميمه الفريد الذي يدمج بين الطبيعة والفن. يعد القصر مثالًا بارزًا على روعة الحضارة الإسلامية في الأندلس.',
                'date' => '749 هـ',
                'address' => 'غرناطة – إسبانيا',
                'author' => 'ملوك بني نصر'
            ],
            [
                'title' => 'خط الثلث',
                'description' => 'يُعتبر خط الثلث من أجمل وأصعب أنواع الخط العربي. ظهر في القرن الثالث الهجري على يد الخطاط ابن مقلة، وأصبح يُستخدم في تزيين المساجد والمصاحف. يتميز الخط بالانحناءات الدقيقة والتناسق البديع بين حروفه، مما يجعله أحد أهم رموز الجمال في الفن الإسلامي.',
                'date' => 'القرن الثالث هـ',
                'address' => 'العالم الإسلامي',
                'author' => 'ابن مقلة'
            ],
            [
                'title' => 'المسجد الأزرق',
                'description' => 'المسجد الأزرق في إسطنبول، المعروف باسم جامع السلطان أحمد، هو تحفة عثمانية معمارية. بُني في عهد السلطان أحمد الأول، ويتميز بتصميمه الداخلي المزخرف بالبلاط الأزرق المميز وقبابه العالية. المسجد يُعد من أهم معالم إسطنبول التاريخية والدينية.',
                'date' => '1026 هـ',
                'address' => 'إسطنبول – تركيا',
                'author' => 'المهندس سنان'
            ],
            [
                'title' => 'مكتبة بيت الحكمة',
                'description' => 'بيت الحكمة كان مركزًا علميًا عظيمًا في العصر العباسي. تأسس في عهد الخليفة المأمون، وكان يُعد مركزًا للترجمة والبحث العلمي. اجتمع فيه علماء من مختلف الديانات والأعراق لنقل العلوم اليونانية والفارسية والهندية إلى العربية، مما ساهم في ازدهار الحضارة الإسلامية.',
                'date' => '215 هـ',
                'address' => 'بغداد – العراق',
                'author' => 'الخليفة المأمون'
            ],
            [
                'title' => 'زخارف جامع السلطان حسن',
                'description' => 'يُعتبر جامع السلطان حسن بالقاهرة من روائع العمارة المملوكية. يتميز بزخارفه الهندسية البديعة وخطوطه العربية المنحوتة على الجدران بدقة فائقة. المسجد يُعد تحفة معمارية تجمع بين الجمال الفني والهندسة المتقدمة.',
                'date' => '757 هـ',
                'address' => 'القاهرة – مصر',
                'author' => 'السلطان حسن بن الناصر محمد'
            ],
        ];

        foreach ($posts as $index => $post) {
            $post = Post::create($post);

            $sourceImagePath = public_path('posts_image_seeder/' . $index . '.jpg');

            if (!File::exists($sourceImagePath)) {
                continue;
            }

            $fileContent = File::get($sourceImagePath);

            $extension = pathinfo($sourceImagePath, PATHINFO_EXTENSION);

            $randomFilename = Str::random(10) . '.' . $extension;

            Storage::disk('public')->put("posts/{$randomFilename}", $fileContent);

            $imagePath = "posts/{$randomFilename}";

            $post->images()->create([
                'path' => $imagePath
            ]);
        }
    }
}
